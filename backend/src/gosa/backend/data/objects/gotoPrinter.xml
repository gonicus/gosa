<?xml version="1.0" encoding="UTF-8"?>
<Objects xmlns="http://www.gonicus.de/Objects">
    <Object>
        <Name>GotoPrinter</Name>
        <DisplayName>Printer</DisplayName>
        <Description>GOto - Gonicus Terminal Concept, objectclass (v2.7)</Description>
        <Backend>LDAP</Backend>
        <Templates>
            <Template>gotoPrinter.json</Template>
            <Template>gotoPrinter-relations.json</Template>
        </Templates>
        <BackendParameters>
            <Backend RDN="cn" objectClasses="gotoPrinter">LDAP</Backend>
            <Backend gotoUserAdminPrinter="PosixUser:uid,gotoUserAdminPrinter=uid"
                     gotoUserPrinter="PosixUser:dn,gotoPrinters=dn"
                     gotoGroupAdminPrinter="GroupOfNames:dn,gotoGroupAdminPrinter=dn"
                     gotoGroupPrinter="GroupOfNames:dn,gotoGroupPrinter=dn"
                     groupAssociation="GotoEnvironment:dn,gotoPrinters=dn">ObjectHandler</Backend>
        </BackendParameters>
        <BaseObject>true</BaseObject>
        <Attributes>
            <Attribute>
                <Name>cn</Name>
                <Description>RFC4519: common name(s) for which the entity is known by</Description>
                <Type>UnicodeString</Type>
                <Mandatory>true</Mandatory>
            </Attribute>
            <Attribute>
                <Name>l</Name>
                <Description>RFC2256: locality which this object resides in</Description>
                <Type>UnicodeString</Type>
                <Mandatory>false</Mandatory>
            </Attribute>
            <Attribute>
                <Name>ipHostNumber</Name>
                <Description>IP address</Description>
                <Type>String</Type>
                <Mandatory>false</Mandatory>
                <Validators>
                    <Condition>
                        <Name>RegEx</Name>
                        <Param>^[\x00-\x7F]*$</Param>
                    </Condition>
                </Validators>
            </Attribute>
            <Attribute>
                <Name>macAddress</Name>
                <Description>MAC address</Description>
                <Type>String</Type>
                <Mandatory>false</Mandatory>
                <Validators>
                    <Condition>
                        <Name>RegEx</Name>
                        <Param>^[\x00-\x7F]*$</Param>
                    </Condition>
                </Validators>
            </Attribute>
            <Attribute>
                <Name>description</Name>
                <Description>RFC4519: descriptive information</Description>
                <Type>UnicodeString</Type>
                <Mandatory>false</Mandatory>
            </Attribute>
            <Attribute>
                <Name>labeledURI</Name>
                <Description>RFC2079: Uniform Resource Identifier with optional label</Description>
                <Type>UnicodeString</Type>
                <Mandatory>false</Mandatory>
            </Attribute>
            <Attribute>
                <Name>maker</Name>
                <Backend>NULL</Backend>
                <Type>UnicodeString</Type>
                <Values populate="getPrinterManufacturers"/>
            </Attribute>
            <Attribute>
                <Name>serverPPD</Name>
                <Backend>NULL</Backend>
                <Type>UnicodeString</Type>
                <Values populate="getPrinterModels" refresh-on-update="true"/>
                <BlockedBy>
                    <Attribute value="null">maker</Attribute>
                </BlockedBy>
            </Attribute>
            <Attribute>
                <Name>configured</Name>
                <Backend>NULL</Backend>
                <Type>Boolean</Type>
                <Default>false</Default>
                <Description>Internal helper attribute to mark PPDs that have been configured since last change.</Description>
            </Attribute>
            <Attribute>
                <Name>gotoPrinterPPD</Name>
                <Description>GOto - Gonicus Terminal Concept, PPD data</Description>
                <Type>String</Type>
                <InFilter>
                    <FilterChain>
                        <FilterEntry>
                            <Filter>
                                <Name>GetMakeModelFromPPD</Name>
                                <Param>maker</Param>
                                <Param>serverPPD</Param>
                                <Param>true</Param>
                            </Filter>
                        </FilterEntry>
                    </FilterChain>
                </InFilter>
                <OutFilter>
                    <FilterChain>
                        <FilterEntry>
                            <Filter>
                                <Name>GetPPDUrl</Name>
                            </Filter>
                        </FilterEntry>
                        <FilterEntry>
                            <Filter>
                                <Name>DeleteOldFile</Name>
                            </Filter>
                        </FilterEntry>
                    </FilterChain>
                </OutFilter>
            </Attribute>
            <Attribute>
                <Name>gotoUserAdminPrinter</Name>
                <Description>GOto - keeps printers we are admin for</Description>
                <Type>String</Type>
                <Mandatory>false</Mandatory>
                <MultiValue>true</MultiValue>
                <Validators>
                    <Condition>
                        <Name>ObjectWithPropertyExists</Name>
                        <Param>PosixUser</Param>
                        <Param>uid</Param>
                    </Condition>
                </Validators>
                <References>
                    <Reference>
                        <Object>PosixUser</Object>
                        <Attribute>uid</Attribute>
                    </Reference>
                </References>
            </Attribute>
            <Attribute>
                <Name>gotoUserPrinter</Name>
                <Description>GOto - keeps printers shown for this user</Description>
                <Type>String</Type>
                <Mandatory>false</Mandatory>
                <MultiValue>true</MultiValue>
                <Validators>
                    <Condition>
                        <Name>ObjectWithPropertyExists</Name>
                        <Param>PosixUser</Param>
                        <Param>uid</Param>
                    </Condition>
                </Validators>
                <References>
                    <Reference>
                        <Object>PosixUser</Object>
                        <Attribute>uid</Attribute>
                    </Reference>
                </References>
            </Attribute>
            <Attribute>
                <Name>groupAssociation</Name>
                <Description>A list of GotoEnvironment this printer is assigned to</Description>
                <Type>String</Type>
                <Backend>ObjectHandler</Backend>
                <MultiValue>true</MultiValue>
                <Validators>
                    <Condition>
                        <Name>ObjectWithPropertyExists</Name>
                        <Param>GotoEnvironment</Param>
                        <Param>dn</Param>
                    </Condition>
                </Validators>
            </Attribute>
            <Attribute>
                <Name>gotoGroupAdminPrinter</Name>
                <Description>GOto - keeps printers we are admin for</Description>
                <Type>String</Type>
                <MultiValue>true</MultiValue>
                <Mandatory>false</Mandatory>
                <Validators>
                    <Condition>
                        <Name>ObjectWithPropertyExists</Name>
                        <Param>GroupOfNames</Param>
                        <Param>dn</Param>
                    </Condition>
                </Validators>
                <References>
                    <Reference>
                        <Object>GroupOfNames</Object>
                        <Attribute>dn</Attribute>
                    </Reference>
                </References>
            </Attribute>
            <Attribute>
                <Name>gotoGroupPrinter</Name>
                <Description>GOto - keeps printers shown for this user</Description>
                <Type>String</Type>
                <MultiValue>true</MultiValue>
                <Mandatory>false</Mandatory>
                <Validators>
                    <Condition>
                        <Name>ObjectWithPropertyExists</Name>
                        <Param>GroupOfNames</Param>
                        <Param>dn</Param>
                    </Condition>
                </Validators>
                <References>
                    <Reference>
                        <Object>GroupOfNames</Object>
                        <Attribute>dn</Attribute>
                    </Reference>
                </References>
            </Attribute>
        </Attributes>
        <Methods>
            <Method>
                <Name>writePPD</Name>
                <Command>writePPD</Command>
                <MethodParameters>
                    <MethodParameter>
                        <Name>data</Name>
                        <Type>UnicodeString</Type>
                    </MethodParameter>
                </MethodParameters>
                <CommandParameters>
                    <Value>cn</Value>
                    <Value>serverPPD</Value>
                    <Value>gotoPrinterPPD</Value>
                    <Value>data</Value>
                </CommandParameters>
            </Method>
            <Method>
                <Name>uploadPPD</Name>
                <Command>uploadPPD</Command>
                <MethodParameters>
                    <MethodParameter>
                        <Name>data</Name>
                        <Type>UnicodeString</Type>
                    </MethodParameter>
                </MethodParameters>
                <CommandParameters>
                    <Value>__self__</Value>
                    <Value>data</Value>
                </CommandParameters>
            </Method>
        </Methods>
        <Find>
            <Aspect>
                <Tag>GotoPrinter</Tag>
                <Keyword>Printer</Keyword>
                <Search>cn</Search>
                <Search>description</Search>
                <Result>
                    <Map>
                        <Source>cn</Source>
                        <Destination>title</Destination>
                    </Map>
                    <Map>
                        <Source><![CDATA[%(maker)s<br/>%(description)s]]></Source>
                        <Destination>description</Destination>
                    </Map>
                </Result>
            </Aspect>
        </Find>
    </Object>
</Objects>
